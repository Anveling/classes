




<!DOCTYPE html>



<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->



<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width" />

	<title>Apache ZooKeeper | Big Data Classes</title>
	
	
	
	<meta property="og:title" content="Apache ZooKeeper | Big Data Classes" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="/lesson/tech/zookeeper.html" />
	<meta property="og:image" content="/_static/path/to/your/opengraph-image.jpg" />
	
	
	<meta property="og:description" content="This is an example of the Foundation Sphinx Theme output." />
	<meta property="og:site_name" content="Big Data Classes" />
	
	
	    	<meta property="og:foo" content="bar" />
	
    
    
	<meta name="description" content="This is an example of the Foundation Sphinx Theme output.">
    
	    	<meta name="foo" content="bar" />
	
	
	
	
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <link rel="stylesheet" href="../../_static/foundation/css/basic.css" type="text/css" />
    	
	<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    	<script type="text/javascript" src="../../_static/jquery.js"></script>
    	<script type="text/javascript" src="../../_static/underscore.js"></script>
    	<script type="text/javascript" src="../../_static/doctools.js"></script>
    	<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    	<script type="text/javascript" src="../../_static/foundation/js/vendor/custom.modernizr.js"></script>
 
<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var s = document.createElement('script');
    var t = document.getElementsByTagName('script')[0];

    s.type = 'text/javascript';
    s.async = true;
    s.src = '//api.flattr.com/js/0.6/load.js?mode=auto';

    t.parentNode.insertBefore(s, t);
 })();
/* ]]> */
</script>

</head>



<body>
	<div id="root"><div class="contain-to-grid">
			<nav class="top-bar">
				<ul class="title-area">
					<li class="name">
					  <h1><a href="../../index.html">Big Data Classes</a></h1>
					</li>
					<li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
				</ul>
				 
				<section class="top-bar-section">
					<ul class="left"><li class="divider"></li></ul>
					
						<ul>
							<li class="has-dropdown">
								<a href="">Sections</a>
								<ul class="dropdown ">
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i524/index.html">I524 Big Data &amp; Open Source Software Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i523/index.html">I523 Big Data Applications and Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Lessons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/index.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../todo.html">Todos</a></li>
</ul>

							</li>
						</ul>
					
					<ul class="left">
						
	<li class="divider"></li>

	
		
			<li><a href="../../genindex.html"  title="General Index">index</a></li>
		

	
					</ul>
				</section>
			</nav>
		</div><div id="header">
			<div class="row">
				
		        <div id="logo-container" class="large-6 columns">
		        	
	<div>
		<a href="../../index.html">
		
	    	<h1 id="logo">Big Data Classes</h1>
		
		</a>
	</div>

		        </div>
		        <div class="large-6 columns">
		            <p id="motto">
						This page is under construction and will change. Content will go live Jan. 9, 2017
					</p>
		        </div>
		        
		    </div>
	    </div>
	    
	    <div class="social-buttons">
	    	
	    </div>
		
		
		
		<div class="row">
	</div>
		
		
		<div class="row">
			
			<div id="content" class="large-9 push-3 columns">
				
  <div class="section" id="apache-zookeeper">
<span id="ref-class-lesson-zookeeper"></span><h1>Apache ZooKeeper<a class="headerlink" href="#apache-zookeeper" title="Permalink to this headline">¶</a></h1>
<p>ZooKeeper is a open source project to provide a configuration and
synchronization service for cluster computing. With ZooKeeper, Hadoop YARN
ResourceManager (RM) is supported with high availability. HBase, Storm and
other software use ZooKeeper for coordinating the cluster.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>ZooKeeper is a distributed, open-source coordination service for distributed
applications. It exposes a simple set of primitives that distributed
applications can build upon to implement higher level services for
synchronization, configuration maintenance, and groups and naming. It is
designed to be easy to program to, and uses a data model styled after the
familiar directory tree structure of file systems. It runs in Java and has
bindings for both Java and C. (as quoted in ZooKeeper overview:
<a class="reference external" href="http://zookeeper.apache.org/doc/trunk/zookeeperOver.html">http://zookeeper.apache.org/doc/trunk/zookeeperOver.html</a>)</p>
<div class="figure" id="id8">
<img alt="../../_images/zkservice.jpg" src="../../_images/zkservice.jpg" />
<p class="caption"><span class="caption-text">Figure 1. ZooKeeper Service</span></p>
</div>
<div class="section" id="key-points">
<h3>Key points<a class="headerlink" href="#key-points" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Data replication</li>
<li>Ensemble is a group of ZooKeeper servers to use replication to achieve high
availability and performance</li>
<li>Odd number of servers due to simple majority voting</li>
<li>Single (Standalone) installation is not for a production model</li>
<li>Leader election</li>
<li>Configuration, Name Service, Group Membership</li>
<li>Wait-free for fault tolerance, performance (compared to Chubby)</li>
<li>Started by Yahoo</li>
</ul>
<p>Chubby is a locking service with strong synchronization guarantees.</p>
</div>
<div class="section" id="zab">
<h3>Zab<a class="headerlink" href="#zab" title="Permalink to this headline">¶</a></h3>
<p>Zab is a leader-based atomic broadcast protocol used in ZooKeeper to guarantee
that update operations satisfy linearizability.</p>
</div>
</div>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>ZooKeeper synchronizes every changes to the tree of znodes across the ZooKeeper
servers, ensemble. This way prevents inconsistency of the data by sharing the
information. If one of the servers fails, the rest of them will replicate state
and trees.</p>
<ul class="simple">
<li>Leader election</li>
<li>Atomic broadcast</li>
</ul>
<div class="section" id="znodes">
<h3>Znodes<a class="headerlink" href="#znodes" title="Permalink to this headline">¶</a></h3>
<p>Znodes is a hierarchical name space of data registers and each znode has a path
with a delimeter &#8220;/&#8221; like a directory structure. There are parent and child
znodes.</p>
</div>
</div>
<div class="section" id="apache-qurator">
<h2>Apache Qurator<a class="headerlink" href="#apache-qurator" title="Permalink to this headline">¶</a></h2>
<p>Apache Qurator is a set of Java libraries for automatic ZooKeeper connection
management with retries and easy development of new ZooKeeper recipes.</p>
<p>Github: <a class="reference external" href="https://github.com/apache/curator">https://github.com/apache/curator</a></p>
</div>
<div class="section" id="zookeeper-installation">
<h2>ZooKeeper Installation<a class="headerlink" href="#zookeeper-installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="required-packages">
<h3>Required Packages<a class="headerlink" href="#required-packages" title="Permalink to this headline">¶</a></h3>
<p>ZooKeeper runs in Java, release 1.6 or greater (JDK 6 or greater).</p>
<p>Java JDK</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">openjdk</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">jdk</span>
</pre></div>
</div>
<p>You can find other installation packages here:
<a class="reference external" href="http://java.sun.com/javase/downloads/index.jsp">http://java.sun.com/javase/downloads/index.jsp</a></p>
</div>
<div class="section" id="zookeeper-server-package">
<h3>ZooKeeper Server Package<a class="headerlink" href="#zookeeper-server-package" title="Permalink to this headline">¶</a></h3>
<p>Download latest here: <a class="reference external" href="http://www.apache.org/dyn/closer.cgi/zookeeper/">http://www.apache.org/dyn/closer.cgi/zookeeper/</a></p>
<p>Download 3.4.6</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">supergsego</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">apache</span><span class="o">/</span><span class="n">zookeeper</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">zookeeper</span><span class="o">-</span><span class="mf">3.4</span><span class="o">.</span><span class="mf">6.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">tar</span> <span class="n">xzf</span> <span class="n">zookeeper</span><span class="o">*.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="n">zookeeper</span><span class="o">-</span><span class="mf">3.4</span><span class="o">.</span><span class="mi">6</span> <span class="n">zookeeper</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-zoo-cfg">
<h3>Configuration <code class="docutils literal"><span class="pre">zoo.cfg</span></code><a class="headerlink" href="#configuration-zoo-cfg" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">zookeeper</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">zoo_sample</span><span class="o">.</span><span class="n">cfg</span> <span class="n">zookeeper</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">zoo</span><span class="o">.</span><span class="n">cfg</span>
<span class="n">nano</span> <span class="n">zookeeper</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">zoo</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
<p>Confirm the settings and update with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tickTime</span><span class="o">=</span><span class="mi">2000</span>
<span class="n">dataDir</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">zookeeper</span>
<span class="n">clientPort</span><span class="o">=</span><span class="mi">2181</span>
</pre></div>
</div>
<ul class="simple">
<li>tickTime: the basic time unit in milliseconds used by ZooKeeper. It is used
to do heartbeats and the minimum session timeout will be twice the tickTime.</li>
<li>dataDir: the location to store the in-memory database snapshots and, unless
specified otherwise, the transaction log of updates to the database.</li>
<li>clientPort: the port to listen for client connections</li>
</ul>
<p>If you have multiple severs, <code class="docutils literal"><span class="pre">zoo.cfg</span></code> has more values, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">server</span><span class="o">.</span><span class="mi">1</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span><span class="mi">2888</span><span class="p">:</span><span class="mi">3888</span>
<span class="n">server</span><span class="o">.</span><span class="mi">2</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">2888</span><span class="p">:</span><span class="mi">3888</span>
<span class="n">server</span><span class="o">.</span><span class="mi">3</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.4</span><span class="p">:</span><span class="mi">2888</span><span class="p">:</span><span class="mi">3888</span>
</pre></div>
</div>
<p>It is <code class="docutils literal"><span class="pre">server.id=host:port:port</span></code></p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Ensemble setup (multi-server)
<a class="reference external" href="http://zookeeper.apache.org/doc/trunk/zookeeperAdmin.html#sc_zkMulitServerSetup">http://zookeeper.apache.org/doc/trunk/zookeeperAdmin.html#sc_zkMulitServerSetup</a></p>
</div>
</div>
<div class="section" id="myid-in-var-lib-zookeeper-for-multi-server">
<h3>myid in <code class="docutils literal"><span class="pre">var/lib/zookeeper</span></code> (For multi-server)<a class="headerlink" href="#myid-in-var-lib-zookeeper-for-multi-server" title="Permalink to this headline">¶</a></h3>
<p>The myid file which stays in <code class="docutils literal"><span class="pre">dataDir</span></code> contains a machine&#8217;s id. If you have 3
servers, first server has 1 in the myid, and second one has 2.  The id must be
unique within the ensemble and should have a value between 1 and 255.</p>
<p>node 1</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">zookeeper</span>
<span class="n">echo</span> <span class="s2">&quot;1&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">zookeeper</span><span class="o">/</span><span class="n">myid</span>
</pre></div>
</div>
<p>node 2</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">zookeeper</span>
<span class="n">echo</span> <span class="s2">&quot;2&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">zookeeper</span><span class="o">/</span><span class="n">myid</span>
</pre></div>
</div>
</div>
<div class="section" id="start-zookeeper-server">
<h3>Start ZooKeeper Server<a class="headerlink" href="#start-zookeeper-server" title="Permalink to this headline">¶</a></h3>
<p>Now that you created the configuration file, you can start ZooKeeper:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">zookeeper</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">zkServer</span><span class="o">.</span><span class="n">sh</span> <span class="n">start</span>
</pre></div>
</div>
</div>
<div class="section" id="zookeeper-client">
<h3>ZooKeeper Client<a class="headerlink" href="#zookeeper-client" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">zookeeper</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">zkCli</span><span class="o">.</span><span class="n">sh</span>
<span class="o">...</span>
<span class="p">[</span><span class="n">zk</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">2181</span><span class="p">(</span><span class="n">CONNECTED</span><span class="p">)</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>If you get access to other nodes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">zookeeper</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">zkCli</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">server</span> <span class="p">[</span><span class="n">node</span> <span class="n">ip</span> <span class="n">address</span><span class="p">]:</span><span class="mi">2181</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="citation">
<h2>Citation<a class="headerlink" href="#citation" title="Permalink to this headline">¶</a></h2>
<p>Hunt, Patrick, et al. &#8220;ZooKeeper: Wait-free Coordination for Internet-scale
Systems.&#8221; USENIX Annual Technical Conference. Vol. 8. 2010. <a class="reference external" href="https://www.usenix.org/event/usenix10/tech/full_papers/Hunt.pdf">[pdf]</a></p>
</div>
<div class="section" id="reading-list">
<h2>Reading List<a class="headerlink" href="#reading-list" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Reed, Benjamin, and Flavio P. Junqueira. &#8220;A simple totally ordered broadcast
protocol.&#8221; proceedings of the 2nd Workshop on Large-Scale Distributed Systems
and Middleware. ACM, 2008. <a class="reference external" href="http://diyhpl.us/~bryan/papers2/distributed/distributed-systems/zab.totally-ordered-broadcast-protocol.2008.pdf">[pdf]</a></li>
<li>Junqueira, Flavio Paiva, Benjamin C. Reed, and Marco Serafini. &#8220;Zab:
High-performance broadcast for primary-backup systems.&#8221; Dependable Systems &amp;
Networks (DSN), 2011 IEEE/IFIP 41st International Conference on. IEEE, 2011.
<a class="reference external" href="http://web.stanford.edu/class/cs347/reading/zab.pdf">[pdf]</a></li>
<li>Design Paper for Hadoop and Zookeeper <a class="reference external" href="https://issues.apache.org/jira/secure/attachment/12486023/MapReduce_NextGen_Architecture.pdf">[pdf]</a></li>
<li>Chapter 14: ZooKeeper in Hadoop: The Definitive Guide By Tom White</li>
</ul>
</div>
<div class="section" id="additional-readling-list">
<h2>Additional Readling List<a class="headerlink" href="#additional-readling-list" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Kirsch, Jonathan, and Yair Amir. &#8220;Paxos for system builders.&#8221; Dept. of CS,
Johns Hopkins University, Tech. Rep (2008). <a class="reference external" href="http://www.cnds.jhu.edu/pub/papers/psb_ladis_08.pdf">[pdf]</a></li>
<li>Baker, Jason, et al. &#8220;Megastore: Providing Scalable, Highly Available Storage
for Interactive Services.&#8221; CIDR. Vol. 11. 2011.  <a class="reference external" href="http://pdos.csail.mit.edu/6.824-2012/papers/jbaker-megastore.pdf">[pdf]</a></li>
<li>Kadambi, Sudarshan, et al. &#8220;Where in the world is my data.&#8221; Proceedings
International Conference on Very Large Data Bases (VLDB). 2011. <a class="reference external" href="http://www.vldb.org/pvldb/vol4/p1040-kadambi.pdf">[pdf]</a></li>
<li>Burrows, Mike. &#8220;The Chubby lock service for loosely-coupled distributed
systems.&#8221; Proceedings of the 7th symposium on Operating systems design and
implementation. USENIX Association, 2006.  <a class="reference external" href="http://static.usenix.org/events/osdi06/tech/full_papers/burrows/burrows_html/">[html]</a></li>
<li>Taylor, Ronald C. &#8220;An overview of the Hadoop/MapReduce/HBase framework and
its current applications in bioinformatics.&#8221; BMC bioinformatics 11.Suppl 12
(2010): S1. <a class="reference external" href="http://www.biomedcentral.com/1471-2105/11/S12/S1">[html]</a></li>
</ul>
</div>
<div class="section" id="acknowledgement">
<h2>Acknowledgement<a class="headerlink" href="#acknowledgement" title="Permalink to this headline">¶</a></h2>
<p>This lesson is adopted from Apache ZooKeeper Documentation:
<a class="reference external" href="http://zookeeper.apache.org/doc/trunk/zookeeperOver.html">http://zookeeper.apache.org/doc/trunk/zookeeperOver.html</a></p>
</div>
</div>


			</div>
			
			
			
			<div id="navigation" class="large-3 pull-9 columns">
				<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i524/index.html">I524 Big Data &amp; Open Source Software Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i523/index.html">I523 Big Data Applications and Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Lessons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/index.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../todo.html">Todos</a></li>
</ul>

			</div>
			
		</div>
		
		<div id="root_footer"></div>
	</div><div id="footer"><div id="bottom-nav"><span><a href="../../genindex.html"  title="General Index">index</a></span>
				</div><div id="footer-notice">
			    	&copy; Copyright 2016, 2017,
			    	Gregor von Laszewski, Badi Abdul-Wahid.
		        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.8.
	    </div></div><script>
		document.write('<script src=' +
		('__proto__' in {} ? '../../_static/foundation/js/vendor/zepto' : 'js/vendor/jquery') +
		'.js><\/script>')
	</script>
	<script src="../../_static/foundation/js/foundation.min.js"></script>
	<script src="../../_static/foundation/js/foundation/foundation.topbar.js"></script>
	<script>
		$(document).foundation();
		
		/**
		 * Fallback svg to png.
		 * Taken from Todd Motto's article:
		 * http://toddmotto.com/mastering-svg-use-for-a-retina-web-fallbacks-with-png-script/
		 */
		if(!Modernizr.svg) {
		    $('img[src*="svg"]').attr('src', function() {
		        return $(this).attr('src').replace('.svg', '.png');
		    });
		}
		
		// Reset width of all table columns.
		$('col').attr('width', null);
		
		// Add "returns" class to all returns elements
		$(".field-name:contains('Returns:')").parent().addClass('returns');
		
		
		
		
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'your-google-analytics-id']);
		_gaq.push(['_trackPageview']);
		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
		
	</script>
	
		<a	id="github-ribbon"
			style="right: 0; border: 0;"
			href="https://github.com/cloudmesh/classes">
			<img
				 src="../../_static/forkme_right_gray_6d6d6d.png"
				 alt="Fork me on GitHub">
		</a>
	
</body>

</html>